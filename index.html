<!doctype html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formation D√©veloppeur Web Python - Mathilde Martine PAISLEY</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Librairie pour lire le CSV Google Sheet -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Outfit:wght@300;400;600;800&family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet">

    <style>
        /* *** STYLES CSS (DESIGN MATHILDE) *** */
        :root {
            --color-cta: #D9A526;
            --color-title: #0F2C48;
            --color-surface: #F6F2E8;
            --color-alert: #B4792A;
            --color-progress: #E91E63;
            --color-b1: #B91C1C;
            --color-b2: #f59e0b;
            --color-b3: #0F2C48;
            
            --brand-blue: var(--color-title);
            --brandGold: var(--color-cta);
            --ivory: var(--color-surface);
            --footer-bg: var(--color-title);
            --footer-text: var(--color-surface);
        }

        .bg-cta { background-color: var(--color-cta); }
        .text-title { color: var(--color-title); }
        .bg-title { background-color: var(--color-title); }
        .bg-surface { background-color: var(--color-surface); }
        .border-title { border-color: var(--color-title); }
        .bg-progress { background-color: var(--color-progress); }
        .text-progress { color: var(--color-progress); }
        
        .bg-b1 { background-color: var(--color-b1); }
        .border-b1 { border-color: var(--color-b1); }
        .text-b1 { color: var(--color-b1); }
        
        .bg-b2 { background-color: var(--color-b2); }
        .border-b2 { border-color: var(--color-b2); }
        .text-b2 { color: var(--color-b2); }

        .bg-b3 { background-color: var(--color-b3); }
        .border-b3 { border-color: var(--color-b3); }
        .text-b3 { color: var(--color-b3); }

        body { font-family: 'Outfit', sans-serif; background-color: var(--color-surface); min-height: 100vh; display: flex; flex-direction: column; }
        .font-code { font-family: 'Fira Code', monospace; }

        /* HEADER */
        .top-bar { background: var(--brand-blue); padding: 12px 0; position: sticky; top: 0; z-index: 9999; border-bottom: 4px solid var(--brandGold); box-shadow: 0 4px 12px rgba(15, 44, 72, 0.3); width: 100%; }
        .top-bar-container { width: 100%; max-width: 100%; padding: 0 40px; display: flex; align-items: center; justify-content: space-between; gap: 16px; }
        .top-left { display: flex; align-items: center; gap: 14px; margin-right: auto; }
        .logo-top { width: 64px; height: 64px; border-radius: 50%; object-fit: cover; border: 2px solid var(--brandGold); background: var(--ivory); padding: 0; transition: transform 0.3s ease; }
        .logo-top:hover { transform: rotate(10deg) scale(1.1); }
        .identity-stack { display: flex; flex-direction: column; }
        .club-title-main { font-family: 'Fira Code', monospace; font-weight: 700; color: var(--ivory); font-size: 1.0rem; letter-spacing: -0.5px; }
        .club-subtitle { color: var(--brandGold); font-weight: 600; font-size: 0.8rem; }
        
        .btn-portfolio-cosmic-desktop { padding: 6px 14px; border-radius: 8px; background: var(--brandGold); color: var(--brand-blue); text-decoration: none; font-family: 'Fira Code', monospace; font-weight: 700; display: inline-flex; gap: 6px; align-items: center; transition: background 0.3s, color 0.3s; white-space: nowrap; box-shadow: 2px 2px 0px var(--color-alert); border: 1px solid var(--ivory); }
        .btn-portfolio-cosmic-desktop:hover { transform: translate(1px, 1px); box-shadow: 1px 1px 0px var(--color-alert); background: var(--ivory); }

        .mobile-icon-btn { width: 40px; height: 40px; flex-shrink: 0; border-radius: 8px; display: none; align-items: center; justify-content: center; text-decoration: none; background: rgba(246, 242, 232, 0.1); color: var(--ivory); border: 1px solid rgba(217, 165, 38, 0.3); transition: all 0.2s ease; font-size: 1.2rem; position: relative; }
        .mobile-icon-btn:hover { transform: translateY(-3px); box-shadow: 0 0 15px rgba(217, 165, 38, 0.5); background: var(--brandGold); color: var(--brand-blue); border-color: var(--ivory); }
        .hamburger-btn { font-size: 1.4rem; cursor: pointer; transition: all 0.2s ease; }
        .hamburger-btn.active { transform: rotate(90deg); }
        .mobile-nav-container { display: none; width: 100%; padding: 10px 0; border-top: 1px solid rgba(255, 255, 255, 0.1); justify-content: center; gap: 8px; flex-wrap: wrap; }
        .mobile-nav-container.visible { display: flex; }

        /* FOOTER */
        .main-footer { background: var(--footer-bg); color: var(--footer-text); padding: 40px 0 20px 0; margin-top: auto; font-family: 'Fira Code', monospace; font-size: 0.85rem; width: 100%; }
        .footer-container { width: 100%; max-width: 100%; padding: 0 40px; margin: 0 auto; display: flex; gap: 30px; align-items: flex-start; justify-content: space-between; flex-wrap: wrap; }
        .footer-left { display: flex; flex-direction: column; gap: 15px; }
        .footer-identity { display: flex; gap: 12px; align-items: center; }
        .footer-logo-img { width: 60px; height: 60px; border-radius: 8px; border: 2px solid var(--brandGold); background: var(--ivory); padding: 0; overflow: hidden; flex-shrink: 0; }
        .footer-logo-img img { width: 100%; height: 100%; object-fit: cover; }
        .footer-details { color: var(--footer-text); opacity: 0.95; display: flex; flex-direction: column; gap: 4px; min-width: 250px; }
        .footer-contact-link { color: var(--brandGold); text-decoration: none; transition: color 0.2s; display: inline-flex; align-items: center; gap: 6px; }
        .footer-contact-link:hover { color: #fff; text-decoration: underline; }
        .footer-links-group-desktop { display: flex; gap: 20px; align-items: flex-start; }
        .footer-section { display: flex; flex-direction: column; gap: 10px; }
        .footer-section-title { font-size: 1rem; font-weight: 700; color: var(--brandGold); margin-bottom: 5px; border-bottom: 2px solid rgba(255, 255, 255, 0.1); padding-bottom: 4px; white-space: nowrap; }
        .footer-links-row { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; justify-content: flex-start; }
        .icon-btn { width: 40px; height: 40px; flex-shrink: 0; border-radius: 8px; display: inline-flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.06); color: var(--footer-text); text-decoration: none; border: 1px solid rgba(217, 165, 38, 0.15); transition: all 0.2s; font-size: 1.1rem; position: relative; }
        .icon-btn:hover { background: var(--brandGold); color: var(--brand-blue); transform: scale(1.1); border-color: #fff; }
        .separator-desktop { width: 1px; height: 120px; background: rgba(255, 255, 255, 0.3); margin: 0 10px; border-radius: 1px; }
        .copyright { width: 100%; text-align: center; color: rgba(255, 255, 255, 0.35); margin-top: 24px; font-size: 0.8rem; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }

        @media (max-width: 1100px) {
            .top-bar-container { flex-direction: row; justify-content: space-between; gap: 10px; padding: 0 20px; }
            .top-left { margin-right: 0; flex-direction: row; align-items: center; }
            .btn-portfolio-cosmic-desktop, .separator-desktop { display: none; }
            .hamburger-btn, .mobile-icon-btn { display: flex; }
            .footer-container { flex-direction: column; align-items: flex-start; padding: 0 20px; gap: 25px; }
            .footer-left, .footer-links-group-desktop, .footer-section { width: 100%; align-items: center; text-align: center; }
            .footer-links-group-desktop { flex-direction: column; gap: 25px; }
            .footer-links-row { justify-content: center; }
            .footer-identity { align-items: center; }
        }

        /* APP STYLES */
        .empty-link-button { 
            opacity: 0.3 !important; 
            pointer-events: none; 
            cursor: default; 
        }
        
        .resource-link-btn { transition: all 0.2s ease-in-out; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .resource-link-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15); }
        
        .tab-button { transition: all 0.2s; border-bottom: 3px solid transparent; }
        .tab-button:hover:not(.active-tab) { background-color: #f8f8f8; border-radius: 8px 8px 0 0; }
        .tab-button.active-tab { border-bottom-color: var(--color-cta); color: var(--color-title); }
        .accordion-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
        .accordion-button.active .accordion-icon { transform: rotate(90deg); }
        .accordion-icon { transition: transform 0.3s ease; }
        #scrollToTopBtn { position: fixed; bottom: 20px; right: 20px; z-index: 1000; opacity: 0; transition: opacity 0.3s, transform 0.3s; transform: scale(0.9); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); }
        #scrollToTopBtn.show { opacity: 1; transform: scale(1); }
        .home-card { border-bottom: 5px solid var(--color-cta); background-color: white; }
        .bloc-section { background-color: white; }
        .awaiting-subject { color: #5a6678; font-style: italic; }
        .awaiting-indicator { animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
        
        /* Spinner pour le chargement */
        .loading-spinner {
            border: 4px solid rgba(217, 165, 38, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: var(--color-cta);
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-0">
    
    <div class="top-bar" id="mainHeader">
        <div class="top-bar-container">
            <div class="top-left">
                <a href="https://projettechacademy.github.io/Projet_Python/index.html" title="Accueil">
                    <img class="logo-top" src="https://projettechacademy.github.io/Projet_Python/Asset/2127845D-F95D-49C0-A22B-88C07817841B.png" alt="Logo Dev Elite Club">
                </a>
                <div class="identity-stack">
                    <div class="club-title-main">üí´ The Dev Elite Club ‚ú®</div>
                    <div class="club-subtitle">La Villa des Codeurs Bris√©s üíî dans la Jungle du PYTHON ! üå¥</div>
                </div>
            </div>

            <div style="display: flex; gap: 10px; align-items: center;">
                <a class="btn-portfolio-cosmic-desktop" href="https://projettechacademy.github.io/CV_MMPA-CV-Mathilde-Martine-PAISLEY/" title="Mon Portfolio">
                    <i class="fa-solid fa-code"></i> Portfolio
                </a>
                <a class="mobile-icon-btn btn-portfolio-mobile" href="https://projettechacademy.github.io/CV_MMPA-CV-Mathilde-Martine-PAISLEY/" title="Mon Portfolio">
                    <i class="fa-solid fa-briefcase"></i> üíº
                </a>
                <div id="hamburgerBtn" class="mobile-icon-btn hamburger-btn" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </div>
            </div>
        </div>
        <nav id="mobileNav" class="mobile-nav-container" aria-label="Navigation mobile"></nav>
    </div>

    <main class="flex-grow p-4 sm:p-8 pt-6">
        <div id="app-container" class="max-w-7xl mx-auto">
            <header class="text-center mb-8 p-6 rounded-xl bg-white shadow-lg border-b-4 border-cta">
                <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-title" style="font-family: 'Playfair Display', serif;">
                    Formation D√©veloppeur Web Python
                </h1>
                <p class="mt-2 text-lg text-gray-600">Programme de formation - Mathilde Martine PAISLEY</p>
                <!-- Zone de notification de chargement -->
                <div id="loading-status" class="mt-4 text-sm text-gray-500">
                    <div class="loading-spinner"></div>
                    <p class="mt-2 text-center">Synchronisation avec ton fichier Excel en cours...</p>
                </div>
            </header>

            <div class="bg-white rounded-xl shadow-lg mb-8 p-4">
                <nav class="flex space-x-4 border-b border-gray-200 overflow-x-auto">
                    <button onclick="showTab('accueil')" id="tab-accueil" class="tab-button active-tab px-4 py-2 text-lg font-medium text-title border-cta whitespace-nowrap">
                        <i class="fas fa-home mr-2"></i> Accueil
                    </button>
                    <button onclick="showTab('B1')" id="tab-B1" class="tab-button px-4 py-2 text-lg font-medium text-gray-600 whitespace-nowrap">
                        <i class="fas fa-list-check mr-2"></i> Bloc B1
                    </button>
                    <button onclick="showTab('B2')" id="tab-B2" class="tab-button px-4 py-2 text-lg font-medium text-gray-600 whitespace-nowrap">
                        <i class="fas fa-tasks mr-2"></i> Bloc B2
                    </button>
                    <button onclick="showTab('B3')" id="tab-B3" class="tab-button px-4 py-2 text-lg font-medium text-gray-600 whitespace-nowrap">
                        <i class="fas fa-code mr-2"></i> Bloc B3
                    </button>
                </nav>
            </div>

            <div id="resources-container" class="space-y-8">
            </div>
        </div>
    </main>

    <button id="scrollToTopBtn" onclick="scrollToTop()" class="bg-cta hover:bg-cta text-white p-4 rounded-full shadow-lg">
        <i class="fas fa-arrow-up text-xl"></i>
    </button>
    
    <footer class="main-footer" role="contentinfo">
        <div class="footer-container">
            <div class="footer-left">
                <div class="footer-identity">
                    <div class="footer-logo-img">
                        <img src="https://projettechacademy.github.io/Projet_Python/Asset/Logo_MMPA.jpeg" alt="Logo MMPA">
                    </div>
                    <div class="footer-details">
                        <div style="font-weight:700; font-size: 1.1rem; margin-bottom:4px;">Mathilde Martine PAISLEY</div>
                        <a href="mailto:Mathilde.martine.paisley@gmail.com" class="footer-contact-link">üìß Mathilde.martine.paisley@gmail.com</a>
                        <a href="tel:+33685900887" class="footer-contact-link">üì≤ 06 85 90 08 87</a>
                    </div>
                </div>
            </div>
            <div class="footer-links-group-desktop">
                <div class="footer-section">
                    <div class="footer-section-title">R√©seaux Sociaux</div>
                    <div class="footer-links-row">
                        <a class="icon-btn" href="https://chat.whatsapp.com/IoMXFl4o2otExYKCPVj22b" title="WhatsApp"><i class="fab fa-whatsapp" style="color:#25D366;"></i></a>
                        <a class="icon-btn" href="https://discord.gg/redT9wEE6T" title="Discord"><i class="fab fa-discord" style="color:#5865F2;"></i></a>
                        <a class="icon-btn" href="https://www.linkedin.com/in/mathilde-martine-paisley-1a4422382/" title="LinkedIn"><i class="fab fa-linkedin" style="color:#0077b5;"></i></a>
                        <a class="icon-btn" href="https://www.instagram.com/enervyx/" title="Instagram"><i class="fab fa-instagram" style="color:#C13584;"></i></a>
                        <a class="icon-btn" href="https://www.tiktok.com/@enervyx" title="TikTok"><i class="fab fa-tiktok" style="color:#ffffff;"></i></a>
                    </div>
                </div>
            </div>
            <div class="copyright">
                üí´ The Dev Elite Club ‚ú® La Villa des Codeurs Bris√©s üíî dans la Jungle du PYTHON ! üå¥ <br> 
                By Mathilde Martine PAISLEY | ¬© 2025 Tous droits r√©serv√©s
            </div>
        </div>
    </footer>

    <script>
        // ---------------------------------------------------------
        // LIEN CSV GOOGLE SHEET CONFIGUR√â (AUTO-SYNC)
        // ---------------------------------------------------------
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQRK_tBmpTFXHK-e-U-cy_XbjLY2cx4FVbP7X0fhLs34B8DLzIr6yUP_eYo4ueAIzFBABopTCQdd-TK/pub?gid=0&single=true&output=csv"; 
        
        let resources = {
            "B1": { title: "B1: Conception et sp√©cification d'une solution digitale", color: "bg-b1", modules: {} },
            "B2": { title: "B2: Gestion et Pilotage de Projet Digital", color: "bg-amber-500", modules: {} },
            "B3": { title: "B3: D√©veloppement Logiciel et Data", color: "bg-b3", modules: {} }
        };

        // Liste des cat√©gories incluant la partie Expert
        const linkCategories = ['Intro_Python_Gamma', 'Cours_Python', 'Audio', 'Excel', 'Infographie', 'Pr√©sentation', 'Video', 'YouTube', 'Expert'];

        // --- CONFIGURATION DES IC√îNES ---
        const linkIcons = {
            "Intro_Python_Gamma": { icon: "G", title: "Introduction / Gamma", linkClass: "bg-indigo-600 hover:bg-indigo-700 font-bold" },
            "Cours_Python": { icon: "üêç", title: "Cours Python", linkClass: "bg-cta hover:bg-yellow-600" },
            "Audio": { icon: "üéß", title: "Audio", linkClass: "bg-teal-600 hover:bg-teal-700" },
            "Excel": { icon: "üìä", title: "Excel", linkClass: "bg-green-600 hover:bg-green-700" },
            "Infographie": { icon: "üñºÔ∏è", title: "Infographie", linkClass: "bg-alert hover:bg-orange-700" }, 
            "Pr√©sentation": { icon: "üìΩÔ∏è", title: "Pr√©sentation", linkClass: "bg-title hover:bg-gray-600" },
            "Video": { icon: "üìπ", title: "Video", linkClass: "bg-red-500 hover:bg-red-600" },
            "YouTube": { icon: "üì∫", title: "Lien YouTube", linkClass: "bg-red-800 hover:bg-red-900" },
            "Expert": { icon: "üëî", title: "Expert Digital / Comptable", linkClass: "bg-slate-700 hover:bg-slate-800" }
        };

        const progressStore = JSON.parse(localStorage.getItem('progressStore') || '{}');

        function fetchDataAndRender() {
            Papa.parse(GOOGLE_SHEET_CSV_URL, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    processCSVData(results.data);
                    document.getElementById('loading-status').style.display = 'none';
                    renderAccueil();
                },
                error: function(err) {
                    document.getElementById('loading-status').innerHTML = `<p class="text-red-600">Erreur de chargement : ${err.message}</p>`;
                }
            });
        }

        // --- MOTEUR BLIND√â (RESPECT STRICT CODIFICATION + D√âTECTION EXPERT) ---
        function processCSVData(data) {
            // R√©initialisation pour √©viter les doublons au rafra√Æchissement
            resources["B1"].modules = {};
            resources["B2"].modules = {};
            resources["B3"].modules = {};

            if (!data || data.length === 0) return;

            // D√©tection dynamique des colonnes
            const keys = Object.keys(data[0] || {});
            const colTitle = keys.find(k => k.toLowerCase().includes('titre') || k.toLowerCase().includes('cat√©gorie')) || 'Titres des cat√©gories';
            
            const colGamma = keys.find(k => k.toLowerCase().includes('gamma')) || 'Intro_Python_Gamma';
            const colPython = keys.find(k => k.toLowerCase().includes('python') && !k.toLowerCase().includes('gamma')) || 'Cours_Python';
            const colAudio = keys.find(k => k.toLowerCase().includes('audio')) || 'Audio';
            const colExcel = keys.find(k => k.toLowerCase().includes('excel')) || 'Excel';
            const colInfo = keys.find(k => k.toLowerCase().includes('infographie')) || 'Infographie';
            const colPres = keys.find(k => k.toLowerCase().includes('pr√©sentation') || k.toLowerCase().includes('presentation')) || 'Pr√©sentation';
            const colVideo = keys.find(k => k.toLowerCase().includes('video')) || 'Video';
            const colYouTube = keys.find(k => k.toLowerCase().includes('youtube')) || 'YouTube';
            const colExpert = keys.find(k => k.toLowerCase().includes('expert')) || 'Expert';

            let currentBloc = null;
            let currentModuleKey = null; 

            data.forEach(row => {
                let titleRaw = row[colTitle];
                if (!titleRaw) return; 

                // 1. D√âTECTION BLOC
                if (/^B[1-3]_/.test(titleRaw) && !titleRaw.includes('_M')) {
                    let parts = titleRaw.split('_');
                    if(parts.length > 0) currentBloc = parts[0];
                }
                
                // 2. D√âTECTION MODULE
                else if ((titleRaw.includes('_M') || titleRaw.includes('_Section')) && !/_S\d/.test(titleRaw)) {
                    if (currentBloc && resources[currentBloc]) {
                        let displayTitle = titleRaw.replace(/^B\d+_/, '').replace(/_/g, ' - ');
                        currentModuleKey = displayTitle; 

                        if (!resources[currentBloc].modules[currentModuleKey]) {
                            resources[currentBloc].modules[currentModuleKey] = [];
                        }
                    }
                }
                
                // 3. D√âTECTION SESSION
                else if (/_S\d/.test(titleRaw)) {
                    if (currentBloc && currentModuleKey && resources[currentBloc]) {
                        
                        let fullCode = "CODE?";
                        let cleanTitle = titleRaw;
                        
                        let matchCode = titleRaw.match(/(B\d+_M\d+_S\d+)/);
                        
                        if (matchCode) {
                            fullCode = matchCode[1];
                            let splitIndex = titleRaw.indexOf(fullCode) + fullCode.length;
                            cleanTitle = titleRaw.substring(splitIndex).replace(/^[-_\s]+/, '');
                        }

                        // Nettoyage des liens pour √©viter les erreurs de clic
                        const cleanLink = (val) => {
                            if (!val) return null;
                            let v = val.trim();
                            if (v === "" || v === "‚òùÔ∏è" || v === "‚òù") return null;
                            let m = v.match(/(https?:\/\/[^\s]+)/);
                            return m ? m[0] : v;
                        };

                        const links = {
                            "Intro_Python_Gamma": cleanLink(row[colGamma]),
                            "Cours_Python": cleanLink(row[colPython]),
                            "Audio": cleanLink(row[colAudio]),
                            "Excel": cleanLink(row[colExcel]),
                            "Infographie": cleanLink(row[colInfo]),
                            "Pr√©sentation": cleanLink(row[colPres]),
                            "Video": cleanLink(row[colVideo]),
                            "YouTube": cleanLink(row[colYouTube]),
                            "Expert": cleanLink(row[colExpert])
                        };

                        resources[currentBloc].modules[currentModuleKey].push({
                            title: cleanTitle,
                            fullCode: fullCode,
                            links: links
                        });
                    }
                }
            });
        }

        function toggleMobileMenu() {
            const nav = document.getElementById('mobileNav');
            const button = document.getElementById('hamburgerBtn');
            nav.classList.toggle('visible');
            button.classList.toggle('active');
        }

        function toggleResourceCompletion(blocKey, subjectId, resourceType) {
            progressStore[blocKey] = progressStore[blocKey] || {};
            progressStore[blocKey][subjectId] = progressStore[blocKey][subjectId] || {};
            progressStore[blocKey][subjectId][resourceType] = !progressStore[blocKey][subjectId][resourceType];
            localStorage.setItem('progressStore', JSON.stringify(progressStore));
            
            const targetElement = document.getElementById(`subject-row-${subjectId}`);
            if (targetElement) { renderSingleSubjectRow(blocKey, subjectId, targetElement); }
            if (currentTab === 'accueil') { renderAccueil(); }
        }

        function validateSubjectLine(blocKey, subjectIndex) {
            const subjectId = `${blocKey}_${subjectIndex}`;
            const subject = getSubjectById(blocKey, subjectIndex);
            
            let allChecked = true;
            for (const type in subject.links) {
                if (subject.links[type] !== null && linkCategories.includes(type) && !isResourceCompleted(blocKey, subjectId, type)) {
                    allChecked = false;
                    break;
                }
            }
            const newState = !allChecked; 
            for (const type in subject.links) {
                if (subject.links[type] !== null && linkCategories.includes(type)) {
                    progressStore[blocKey][subjectId] = progressStore[blocKey][subjectId] || {};
                    progressStore[blocKey][subjectId][type] = newState;
                }
            }
            localStorage.setItem('progressStore', JSON.stringify(progressStore));
            const targetElement = document.getElementById(`subject-row-${subjectId}`);
            if (targetElement) { renderSingleSubjectRow(blocKey, subjectId, targetElement); }
            if (currentTab === 'accueil') { renderAccueil(); }
        }

        function getSubjectProgress(blocKey, subjectIndex) {
            const subjectId = `${blocKey}_${subjectIndex}`;
            const subject = getSubjectById(blocKey, subjectIndex);
            if (!subject) return 0;
            let totalAvailable = 0;
            let completedCount = 0;
            for (const type in subject.links) {
                if (subject.links[type] !== null && linkCategories.includes(type)) {
                    totalAvailable++;
                    if (isResourceCompleted(blocKey, subjectId, type)) { completedCount++; }
                }
            }
            return totalAvailable > 0 ? Math.round((completedCount / totalAvailable) * 100) : 0;
        }

        function isResourceCompleted(blocKey, subjectId, resourceType) {
            return progressStore[blocKey] && progressStore[blocKey][subjectId] && progressStore[blocKey][subjectId][resourceType];
        }
        
        function getSubjectById(blocKey, index) {
            if (typeof index === 'string' && index.includes('_')) {
                index = parseInt(index.split('_')[1]);
            }
            const moduleKeys = Object.keys(resources[blocKey].modules);
            let globalIndex = 0;
            for(let i = 0; i < moduleKeys.length; i++) {
                const sessions = resources[blocKey].modules[moduleKeys[i]];
                for(let j = 0; j < sessions.length; j++) {
                    if (globalIndex === index) { return sessions[j]; }
                    globalIndex++;
                }
            }
            return null;
        }

        function renderSingleSubjectRow(blocKey, subjectId, targetElement) {
            const globalIndex = parseInt(subjectId.split('_')[1]);
            const session = getSubjectById(blocKey, globalIndex);
            if (!session) return;

            const progressPercent = getSubjectProgress(blocKey, globalIndex);
            const isFullyCompleted = progressPercent === 100;
            
            let linksHtml = '';
            
            linkCategories.forEach(catKey => {
                const link = session.links[catKey];
                const meta = linkIcons[catKey];
                const isAvailable = link !== null && link !== "" && link !== undefined; 
                const isChecked = isResourceCompleted(blocKey, subjectId, catKey);
                
                let linkButton;
                if (isAvailable) {
                    linkButton = `<a href="${link}" title="${meta.title}" target="_blank" class="resource-link-btn inline-flex items-center justify-center w-8 h-8 rounded-full text-white ${meta.linkClass} text-lg">${meta.icon}</a>`;
                } else {
                    linkButton = `<span title="${meta.title} (Vide)" class="inline-flex items-center justify-center w-8 h-8 rounded-full text-white ${meta.linkClass} empty-link-button text-lg">${meta.icon}</span>`;
                }
                
                const checkButton = `<button onclick="toggleResourceCompletion('${blocKey}', '${subjectId}', '${catKey}')" class="progress-check-btn inline-flex items-center justify-center w-6 h-6 rounded-full text-white text-sm transition duration-150 ${isChecked ? 'bg-progress hover:bg-red-500' : 'bg-gray-300 hover:bg-gray-400'}" ${!isAvailable ? 'disabled' : ''}><i class="fas ${isChecked ? 'fa-check' : 'fa-plus'}"></i></button>`;
                
                linksHtml += `<div class="flex items-center space-x-1">${linkButton}${checkButton}</div>`;
            });

            const hasAnyLink = Object.values(session.links).some(l => l !== null && l !== "" && l !== undefined);
            const isAwaitingAll = !hasAnyLink;
            const lineClass = isAwaitingAll ? 'awaiting-subject' : 'text-gray-700';
            
            const accentColorClassInner = (blocKey === 'B1') ? 'text-b1' : (blocKey === 'B2') ? 'text-b2' : 'text-title';
            const isCompletedLineClass = isFullyCompleted ? 'border-l-4 border-progress' : 'border-l-4 border-gray-100';

            targetElement.outerHTML = `
                <div id="subject-row-${subjectId}" class="flex flex-col sm:flex-row items-start sm:items-center justify-between bg-white p-3 rounded-lg shadow-sm border border-gray-100 ${isCompletedLineClass} mb-2">
                    <div class="flex items-center flex-grow min-w-0 mb-2 sm:mb-0">
                        <label for="check_${subjectId}" class="text-base font-medium cursor-pointer ${lineClass} flex items-center min-w-0">
                            <span class="font-mono ${accentColorClassInner} mr-2 font-bold flex-shrink-0 text-sm tracking-tight">${session.fullCode}</span>
                            <span class="truncate" title="${session.title}"> - ${session.title}</span>
                            ${isAwaitingAll ? `<i class="fas fa-triangle-exclamation text-alert ml-3 awaiting-indicator" title="Sujet en attente de ressources"></i>` : ''}
                        </label>
                    </div>
                    <div class="flex items-center space-x-2 flex-shrink-0 mt-2 sm:mt-0 flex-wrap justify-end gap-y-2">
                        <div class="link-icon-container flex space-x-2 flex-shrink-0">
                            ${linksHtml}
                        </div>
                        <div class="flex items-center space-x-2 ml-4">
                            <button title="${progressPercent}%" class="w-16 bg-gray-200 text-title py-1 rounded-lg text-xs font-bold text-progress">${progressPercent}%</button>
                            <button onclick="validateSubjectLine('${blocKey}', ${globalIndex})" title="Valider tout" class="w-8 h-8 rounded-full text-white transition duration-150 flex items-center justify-center ${isFullyCompleted ? 'bg-progress hover:bg-red-500' : 'bg-gray-400 hover:bg-progress'}"><i class="fas ${isFullyCompleted ? 'fa-check' : 'fa-plus'}"></i></button>
                            <button onclick="showPlanningOptions('${blocKey}', ${globalIndex}, '${session.title.replace(/'/g, "\\'")}')" title="Agenda" class="w-8 h-8 rounded-full bg-title hover:bg-gray-600 text-white transition duration-150 flex items-center justify-center"><i class="fas fa-clock"></i></button>
                        </div>
                    </div>
                </div>`;
        }

        function generateGoogleCalendarLink(title, daysFromNow, subjectTitle) {
            const date = new Date();
            date.setDate(date.getDate() + daysFromNow);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const start = `${year}${month}${day}T100000`; 
            const end = `${year}${month}${day}T120000`; 
            const details = encodeURIComponent(`Relecture planifi√©e pour ${subjectTitle}`);
            const text = encodeURIComponent(`[RELECTURE] ${subjectTitle}`);
            return `https://www.google.com/calendar/render?action=TEMPLATE&text=${text}&dates=${start}/${end}&details=${details}&sf=true&output=xml`;
        }
        
        function showPlanningOptions(blocKey, subjectIndex, subjectTitle) {
            const modalContent = document.getElementById('planningModalContent');
            const options = [ { days: 3, label: "Relire √† J+3" }, { days: 7, label: "Relire √† J+7" }, { days: 30, label: "Relire √† J+30" } ];
            const optionsHtml = options.map(opt => { const link = generateGoogleCalendarLink(blocKey, opt.days, subjectTitle); return `<a href="${link}" onclick="closeModal('planningModal')" class="w-full bg-title text-white py-2 px-4 rounded-lg hover:opacity-90 transition duration-150 text-center font-semibold mb-2 block">${opt.label}</a>`; }).join('');
            modalContent.innerHTML = `<h3 class="text-xl font-bold text-title mb-4 text-center">Planifier la Relecture</h3><div class="space-y-2">${optionsHtml}</div><button onclick="closeModal('planningModal')" class="mt-4 w-full text-title border border-gray-300 py-2 rounded-lg hover:bg-gray-100">Fermer</button>`;
            document.getElementById('planningModal').classList.remove('hidden');
        }

        function closeModal(modalId) { document.getElementById(modalId).classList.add('hidden'); }

        let currentTab = 'accueil';

        function showTab(tabName) {
            currentTab = tabName;
            document.getElementById('resources-container').innerHTML = '';
            document.querySelectorAll('.tab-button').forEach(btn => { btn.classList.remove('active-tab', 'text-title', 'border-cta'); btn.classList.add('text-gray-600'); });
            const activeTabButton = document.getElementById(`tab-${tabName}`);
            activeTabButton.classList.add('active-tab', 'text-title');
            if (tabName === 'accueil') { renderAccueil(); } else { renderBloc(tabName); }
        }

        function renderAccueil() {
            const container = document.getElementById('resources-container');
            const blocksHtml = Object.keys(resources).map(key => {
                let blocTotal = 0; let blocCompleted = 0; let tempCounter = 0;
                for (const module in resources[key].modules) {
                    resources[key].modules[module].forEach(subj => {
                        const progress = getSubjectProgress(key, tempCounter);
                        if (progress === 100) blocCompleted++;
                        blocTotal++; tempCounter++;
                    });
                }
                const percentage = blocTotal > 0 ? Math.round((blocCompleted / blocTotal) * 100) : 0;
                const blocTitle = resources[key].title.split(':')[0];
                return `<div class="p-6 rounded-xl shadow-lg bg-white space-y-4 home-card ${key === 'B1' ? 'border-b1' : key === 'B2' ? 'border-b2' : 'border-title'}" style="border-top: 4px solid var(--color-cta);"><h3 class="text-xl font-semibold flex items-center mb-4 text-title"><i class="fas fa-cubes mr-3"></i> ${blocTitle} (${blocCompleted}/${blocTotal})</h3><div class="flex h-2 mb-4 bg-gray-200 rounded overflow-hidden"><div style="width:${percentage}%" class="bg-progress shadow-none"></div></div><button onclick="showTab('${key}')" class="w-full bg-cta text-title py-2 rounded-lg hover-bg-cta transition duration-150 font-semibold">Ouvrir le Bloc</button></div>`;
            }).join('');
            container.innerHTML = `<div class="grid grid-cols-1 md:grid-cols-3 gap-6">${blocksHtml}</div>`;
        }

        function renderBloc(blocKey) {
            const container = document.getElementById('resources-container');
            const bloc = resources[blocKey];
            let html = `<section class="bloc-section bg-surface p-6 rounded-xl shadow-lg border-l-4 ${blocKey === 'B1' ? 'border-b1' : blocKey === 'B2' ? 'border-b2' : 'border-title'}"><h2 class="text-3xl font-bold text-title border-b pb-3 mb-4">${bloc.title}</h2><div class="space-y-4">`;
            
            let globalSubjectIndex = 0;
            for (const moduleTitle in bloc.modules) {
                const sessions = bloc.modules[moduleTitle];
                const moduleId = blocKey + "_" + moduleTitle.replace(/\s/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
                html += `<div class="module-card rounded-lg border border-gray-200 overflow-hidden shadow-md mb-4"><button id="btn-${moduleId}" onclick="toggleAccordion('${moduleId}')" class="accordion-button flex justify-between items-center w-full p-4 bg-white hover:bg-gray-50 transition duration-150"><h3 class="text-xl font-semibold text-title flex items-center"><i class="fas fa-folder-open mr-2"></i> ${moduleTitle}</h3><i class="fas fa-chevron-right accordion-icon"></i></button><div id="content-${moduleId}" class="accordion-content p-0"><div class="space-y-2 p-4 pt-0 border-t">`;
                sessions.forEach(() => {
                    const subjectId = `${blocKey}_${globalSubjectIndex}`;
                    html += `<div id="subject-row-${subjectId}"></div>`; 
                    globalSubjectIndex++;
                });
                html += `</div></div></div>`;
            }
            html += `</div></section>`;
            container.innerHTML = html;

            let tempIndex = 0;
            for (const moduleTitle in bloc.modules) {
                bloc.modules[moduleTitle].forEach(() => {
                    const targetElement = document.getElementById(`subject-row-${blocKey}_${tempIndex}`);
                    if(targetElement) renderSingleSubjectRow(blocKey, `${blocKey}_${tempIndex}`, targetElement);
                    tempIndex++;
                });
            }
        }

        function updateAllProgressBars() { if (currentTab === 'accueil') { renderAccueil(); } else { renderBloc(currentTab); } }
        function toggleAccordion(moduleId) { 
            const content = document.getElementById(`content-${moduleId}`); 
            const button = document.getElementById(`btn-${moduleId}`); 
            if (content.style.maxHeight) { content.style.maxHeight = null; button.classList.remove('active'); } 
            else { content.style.maxHeight = content.scrollHeight + "px"; button.classList.add('active'); } 
        }
        
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        window.onscroll = function() { if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) { scrollToTopBtn.classList.add('show'); } else { scrollToTopBtn.classList.remove('show'); } };
        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        
        document.addEventListener('DOMContentLoaded', fetchDataAndRender);
    </script>
    
    <div id="planningModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50"><div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full"><div id="planningModalContent"></div></div></div>
</body>
</html>
